var SRCS = files(".") with ending(".cpp")
var OBJS = swap(".cpp" ".o") on expand(SRCS)

var CXX = "g++"
var CXXFLAGS = "-std=c++14 -g3 -Wall -Wno-strict-aliasing -pedantic -Iinclude"
var CC = "gcc"
var TARGET = "basil"

for src obj in OBJS do
    if newer(src obj) do
        run(CXX CXXFLAGS "-c" src "-o" obj)
    end
end

run(CXX CXXFLAGS outputs(OBJS) "-o" TARGET)

if newer("lib/core.c" "lib/core.o") do
    run(CC "-std=gnu99 -Os -Wall -fno-stack-protector" "-c" "lib/core.c" "-o" "lib/core.o")
end
